<!--template.html-->
<!DOCTYPE html>
<html>

<head>
    <title>Gosling Visualization</title>
    <link rel="stylesheet" href="https://esm.sh/higlass@1.13/dist/hglib.css">
    <!--<link rel="stylesheet" href="stylesheet.css">-->
    <!-- 0.12.0 is the latest gosling version -->
    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18",
                "react-dom": "https://esm.sh/react-dom@18",
                "pixi": "https://esm.sh/pixi.js@6",
                "gosling.js": "https://esm.sh/gosling.js@0.12.0?external=react,react-dom,pixi"
            }
        }
    </script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }

        p {
            margin: 2em
        }

        .overlay {
            border: 2px solid rgb(237, 230, 226);
            background-color: rgb(255, 255, 255);
            border-radius: 5px;
            text-align: left;
            max-width: fit-content;
            margin: 5em;
            margin-right: 2em;
            margin-bottom: 2em;
            position: fixed;
            z-index: 999;
            right: 0;
            bottom: 0;

            .circle {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                margin: 0.3em;
                margin-top:0;
            }

            .circles {
                display: inline-flex;
                margin-left:2em;
            }
        }
    </style>
</head>

<body>
    <div class="overlay" style="margin-top: 20em;">
        <p><b>Atlantic</b><br>
            Darker colors:
        <div class="circles">
            <div class="circle" style="background-color: rgba(255, 0, 0, 1);"></div>
            <div class="circle" style="background-color: blue;"></div>
            <div class="circle" style="background-color: darkorange;"></div>
            <div class="circle" style="background-color: purple;"></div>
            <div class="circle" style="background-color: green;"></div>
        </div>
        </p>
        <p>
            <b>Mediterranian</b><br>
            Lighter colors:
        <div class="circles">
            <div class="circle" style="background-color: rgba(255, 0, 0, 0.4);"></div>
            <div class="circle" style="background-color: lightblue;"></div>
            <div class="circle" style="background-color: gold"></div>
            <div class="circle" style="background-color: violet;"></div>
            <div class="circle" style="background-color: lightgreen;"></div>
        </div>

        </p>
    </div>
    <div id="plot-container-1"></div>

    <script type="module">
        import { embed } from 'gosling.js';
        import { plot_spec as plot_1_Spec } from '../plot_1_FST.js';
        import { plot_spec as plot_2_θ_Spec } from '../plot_2_θ.js';
        import { plot_spec as plot_2_π_Spec } from '../plot_2_π.js';
        import { plot_spec as plot_2_td_Spec } from '../plot_2_td.js';
        import { plot_spec as plot_3_Spec_MD } from '../plot_3_mapping_depths.js';
        import { plot_spec as plot_3_Spec_Nr_samples } from '../plot_3_nr_of_samples.js';
        import { plot_spec as plot_3_Spec_MD_Normalized } from '../plot_3_mapping_depths_normalized.js';
        import { plot_spec as plot_3_Spec_Nr_samples_Normalized } from '../plot_3_nr_of_samples_normalized.js';

        const filePaths = ["../data/gene_regions/seq_c_23164.REF_STRG_1_64511_XLOC_008442.snps.tsv", "../data/gene_regions/seq_c_23164.REF_STRG_1_64511_XLOC_008442.windows.tsv", "../data/gene_regions/seq_c_23164.REF_STRG_1_64511_XLOC_008442.windows.tsv", "../data/gene_regions.data_mappings/seq_c_23164.REF_STRG_1_64511_XLOC_008442.mappings.windows_1000.at.tsv", "../data/gene_regions.data_mappings/seq_c_23164.REF_STRG_1_64511_XLOC_008442.mappings.windows_1000.me.tsv"];

        document.addEventListener('DOMContentLoaded', function () {
            filePaths.forEach(function (filePath, button_data_track_number) {
                URLfromFile(filePath, button_data_track_number);
            });
            PlotAll();
        });

        async function PlotAll() {
            try {
                const plotSpec = {
                    "arrangement": "vertical",
                    "views":
                        [plot_1_Spec,
                            {
                                "arrangement": "horizontal",
                                "views": [
                                    plot_2_π_Spec,
                                    plot_2_θ_Spec
                                ]
                            },
                            plot_2_td_Spec,
                            {
                                "arrangement": "horizontal",
                                "views": [plot_3_Spec_MD,
                                    plot_3_Spec_Nr_samples
                                ]
                            },
                            {
                                "arrangement": "horizontal",
                                "views": [
                                    plot_3_Spec_MD_Normalized
                                    ,
                                    plot_3_Spec_Nr_samples_Normalized,
                                ]
                            }

                        ],


                    "responsiveSize": true
                };

                const container = document.getElementById('plot-container-1');
                await embed(container, plotSpec);
            }
            catch (error) {
                console.error("Error embedding plot:", error);
            }
        };

        async function URLfromFile(filePath, button_data_track_number) {
            try {
                const fileURL = filePath;
                if (fileURL) {
                    GoslingPlotWithLocalData(fileURL, button_data_track_number);
                }
            } catch (error) {
                console.error(error);
            }
        }

        async function GoslingPlotWithLocalData(fileURL, button_data_track_number) {
            try {
                let trackData;
                let plotSpec;

                if (button_data_track_number <= 1) {
                    trackData = plot_1_Spec.tracks[button_data_track_number].data;
                    trackData.url = fileURL;
                }

                else if (button_data_track_number == 2) {
                    plot_2_π_Spec.tracks.slice(0, 1).forEach((track) => {
                        track.data.url = fileURL;
                    });

                    plot_2_π_Spec.tracks.slice(1, 2).forEach((track) => {
                        track.data.url = fileURL;
                    });

                    plot_2_θ_Spec.tracks.slice(0, 1).forEach((track) => {
                        track.data.url = fileURL;
                    });

                    plot_2_θ_Spec.tracks.slice(1, 2).forEach((track) => {
                        track.data.url = fileURL;
                    });

                    plot_2_td_Spec.tracks.slice(0, 1).forEach((track) => {
                        track.data.url = fileURL;
                    });
                    plot_2_td_Spec.tracks.slice(1, 2).forEach((track) => {
                        track.data.url = fileURL;
                    });
                }
                else if (button_data_track_number == 3) {
                    plot_3_Spec_MD.tracks.slice(0, 1).forEach((track) => {
                        track.data.url = fileURL;
                    });

                    plot_3_Spec_Nr_samples.tracks.slice(0, 1).forEach((track) => {
                        track.data.url = fileURL;
                    });

                    plot_3_Spec_MD_Normalized.tracks.slice(0, 1).forEach((track) => {
                        track.data.url = fileURL;
                    });

                    plot_3_Spec_Nr_samples_Normalized.tracks.slice(0, 1).forEach((track) => {
                        track.data.url = fileURL;
                    });
                }

                else if (button_data_track_number == 4) {
                    plot_3_Spec_MD.tracks.slice(1, 2).forEach((track) => {
                        track.data.url = fileURL;
                    });

                    plot_3_Spec_Nr_samples.tracks.slice(1, 2).forEach((track) => {
                        track.data.url = fileURL;
                    });
                    plot_3_Spec_MD_Normalized.tracks.slice(1, 2).forEach((track) => {
                        track.data.url = fileURL;
                    });

                    plot_3_Spec_Nr_samples_Normalized.tracks.slice(1, 2).forEach((track) => {
                        track.data.url = fileURL;
                    });

                }
                else {
                    console.error('Invalid button_data_track_number:', button_data_track_number);
                    return;
                }

            }
            catch (error) {
                console.error(error);
            }
        }
    </script>
</body>

</html>